<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拼音分解测试</title>
</head>
<body>
    <h1>拼音分解测试</h1>
    <div id="result"></div>
    
    <script>
        // 拼音到汉字的映射表
        const pinyinToCharacterMap = {
            // 声母
            'b': '波', 'p': '坡', 'm': '摸', 'f': '佛',
            'd': '得', 't': '特', 'n': '讷', 'l': '勒',
            'g': '哥', 'k': '科', 'h': '喝',
            'j': '基', 'q': '欺', 'x': '西',
            'zh': '知', 'ch': '蚩', 'sh': '诗', 'r': '儿',
            'z': '资', 'c': '雌', 's': '思',
            'y': '衣', 'w': '乌',
            
            // 韵母
            'a': '啊', 'o': '喔', 'e': '鹅', 'i': '一', 'u': '乌', 'ü': '迂',
            'ai': '哀', 'ei': '诶', 'ui': '威', 'ao': '袄', 'ou': '欧', 'iu': '优',
            'ie': '耶', 'üe': '约', 'er': '儿',
            'an': '安', 'en': '嗯', 'in': '因', 'un': '温', 'ün': '晕',
            'ang': '昂', 'eng': '亨', 'ing': '英', 'ong': '翁',
            'ǎo': '袄'
        };
        
        // 拼音分解函数
        function decomposePinyin(pinyin, character) {
            console.log('开始分解拼音:', pinyin, '字符:', character);
            
            // 特殊字符处理
            if (character === '土') {
                return ['土'];
            }
            if (character === '水') {
                return ['水'];
            }
            if (character === '日') {
                return [];
            }
            
            let result = [];
            let workingPinyin = pinyin.toLowerCase();
            let tone = '';
            
            // 声调映射
            const toneMap = {
                'ā': ['a', '1'], 'á': ['a', '2'], 'ǎ': ['a', '3'], 'à': ['a', '4'],
                'ē': ['e', '1'], 'é': ['e', '2'], 'ě': ['e', '3'], 'è': ['e', '4'],
                'ī': ['i', '1'], 'í': ['i', '2'], 'ǐ': ['i', '3'], 'ì': ['i', '4'],
                'ō': ['o', '1'], 'ó': ['o', '2'], 'ǒ': ['o', '3'], 'ò': ['o', '4'],
                'ū': ['u', '1'], 'ú': ['u', '2'], 'ǔ': ['u', '3'], 'ù': ['u', '4'],
                'ǖ': ['ü', '1'], 'ǘ': ['ü', '2'], 'ǚ': ['ü', '3'], 'ǜ': ['ü', '4']
            };
            
            for (let char of workingPinyin) {
                if (toneMap[char]) {
                    workingPinyin = workingPinyin.replace(char, toneMap[char][0]);
                    tone = toneMap[char][1];
                }
            }
            
            // 分解声母和韵母
            let shengmu = '';
            let yunmu = '';
            
            // 识别声母（按长度从长到短匹配）
            const shengmuList = ['zh', 'ch', 'sh', 'b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'r', 'z', 'c', 's', 'y', 'w'];
            
            // 先尝试用原始拼音（带声调）进行分解
            let originalPinyin = pinyin.toLowerCase();
            
            for (let sm of shengmuList) {
                if (originalPinyin.startsWith(sm)) {
                    shengmu = sm;
                    yunmu = originalPinyin.substring(sm.length);
                    break;
                }
            }
            
            // 如果没有找到声母，整个就是韵母
            if (!shengmu) {
                yunmu = originalPinyin;
            }
            
            console.log('声母:', shengmu, '韵母:', yunmu);
            
            // 添加对应的汉字发音
            if (shengmu && pinyinToCharacterMap[shengmu]) {
                result.push(pinyinToCharacterMap[shengmu]);
            }

            // 处理韵母 - 特别处理复合韵母如"iǎo"需要分解为"i" + "ǎo"
            if (yunmu) {
                // 先尝试整个韵母的映射
                if (pinyinToCharacterMap[yunmu]) {
                    result.push(pinyinToCharacterMap[yunmu]);
                } else {
                    // 如果整个韵母没有映射，尝试分解复合韵母
                    // 例如："iǎo" -> "i" + "ǎo"
                    let processed = false;
                    
                    // 检查是否以单个韵母开头
                    const singleVowels = ['i', 'u', 'ü', 'a', 'o', 'e'];
                    for (let vowel of singleVowels) {
                        if (yunmu.startsWith(vowel)) {
                            // 添加第一个韵母
                            if (pinyinToCharacterMap[vowel]) {
                                result.push(pinyinToCharacterMap[vowel]);
                            }
                            
                            // 处理剩余部分
                            let remaining = yunmu.substring(vowel.length);
                            if (remaining && pinyinToCharacterMap[remaining]) {
                                result.push(pinyinToCharacterMap[remaining]);
                            }
                            processed = true;
                            break;
                        }
                    }
                    
                    // 如果还没处理，尝试去掉声调的版本
                    if (!processed) {
                        let yunmuNoTone = workingPinyin.substring(shengmu.length);
                        if (yunmuNoTone && pinyinToCharacterMap[yunmuNoTone]) {
                            result.push(pinyinToCharacterMap[yunmuNoTone]);
                        }
                    }
                }
            }
            
            console.log('分解结果:', result);
            return result;
        }
        
        // 测试"小"字的拼音分解
        const testResult = decomposePinyin('xiǎo', '小');
        document.getElementById('result').innerHTML = `
            <h2>测试结果：</h2>
            <p><strong>字符：</strong>小</p>
            <p><strong>拼音：</strong>xiǎo</p>
            <p><strong>分解结果：</strong>[${testResult.join(', ')}]</p>
            <p><strong>期望结果：</strong>[西, 一, 袄]</p>
            <p><strong>测试状态：</strong>${JSON.stringify(testResult) === JSON.stringify(['西', '一', '袄']) ? '✅ 通过' : '❌ 失败'}</p>
        `;
    </script>
</body>
</html